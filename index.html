
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A search engine for ducks">
      
      
        <meta name="author" content="Raphael Sourty">
      
      
        <link rel="canonical" href="https://lightonai.github.io/ducksearch/">
      
      
      
        <link rel="next" href="api/overview/">
      
      
      <link rel="icon" href="img/logo.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.32">
    
    
      
        <title>ducksearch</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Fira Sans";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
      <link rel="stylesheet" href="css/version-select.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#installation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="ducksearch" class="md-header__button md-logo" aria-label="ducksearch" data-md-component="logo">
      
  <img src="img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ducksearch
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/lightonai/ducksearch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lighton/ducksearch
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="documentation/upload/" class="md-tabs__link">
          
  
    
  
  Documentation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="benchmarks/benchmarks/" class="md-tabs__link">
          
  
    
  
  Benchmarks

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="api/overview/" class="md-tabs__link">
          
  
    
  
  API reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="ducksearch" class="md-nav__button md-logo" aria-label="ducksearch" data-md-component="logo">
      
  <img src="img/logo.png" alt="logo">

    </a>
    ducksearch
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lightonai/ducksearch" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    lighton/ducksearch
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="documentation/upload/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="benchmarks/benchmarks/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Benchmarks
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="api/overview/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    API reference
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    <span class="md-ellipsis">
      Installation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Documentation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Documentation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upload" class="md-nav__link">
    <span class="md-ellipsis">
      Upload
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#search" class="md-nav__link">
    <span class="md-ellipsis">
      Search
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete-and-update-index" class="md-nav__link">
    <span class="md-ellipsis">
      Delete and update index
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extra-features" class="md-nav__link">
    <span class="md-ellipsis">
      Extra features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extra features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#huggingface" class="md-nav__link">
    <span class="md-ellipsis">
      HuggingFace
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tables" class="md-nav__link">
    <span class="md-ellipsis">
      Tables
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      Benchmark
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#license" class="md-nav__link">
    <span class="md-ellipsis">
      License
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#citation" class="md-nav__link">
    <span class="md-ellipsis">
      Citation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<div align="center">
  <h1>DuckSearch</h1>
  <p>Efficient BM25 with DuckDB 🦆</p>
</div>

<p align="center"><img width=500 src="img/logo.png"/></p>

<div align="center">
  <!-- Documentation -->
  <a href="https://lightonai.github.io/ducksearch/"><img src="https://img.shields.io/badge/Documentation-purple.svg?style=flat-square" alt="documentation"></a>
  <!-- License -->
  <a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/MIT-blue.svg?style=flat-square" alt="license"></a>
</div>

<p align="justify">
DuckSearch is a lightweight and easy-to-use library to search documents. DuckSearch is built on top of DuckDB, a high-performance analytical database. DuckDB is designed to execute analytical SQL queries fast, and DuckSearch leverages this to provide efficient search and filtering features. DuckSearch index can be updated with new documents and documents can be deleted as well. DuckSearch also supports HuggingFace datasets, allowing to index datasets directly from the HuggingFace Hub.
</p>

<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<p>Install DuckSearch using pip:</p>
<div class="language-bash highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>ducksearch
</code></pre></div>
<h2 id="documentation">Documentation<a class="headerlink" href="#documentation" title="Permanent link">&para;</a></h2>
<p>The complete documentation is available <a href="https://lightonai.github.io/ducksearch/">here</a>, which includes in-depth guides, examples, and API references.</p>
<h3 id="upload">Upload<a class="headerlink" href="#upload" title="Permanent link">&para;</a></h3>
<p>We can upload documents to DuckDB using the <code>upload.documents</code> function. The documents are stored in a DuckDB database, and the <code>fields</code> are indexed with BM25.</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">ducksearch</span> <span class="kn">import</span> <span class="n">upload</span>

<span class="n">documents</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Hotel California&quot;</span><span class="p">,</span>
        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;rock&quot;</span><span class="p">,</span>
        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;1977-02-22&quot;</span><span class="p">,</span>
        <span class="s2">&quot;popularity&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Here Comes the Sun&quot;</span><span class="p">,</span>
        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;rock&quot;</span><span class="p">,</span>
        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;1969-06-10&quot;</span><span class="p">,</span>
        <span class="s2">&quot;popularity&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Alive&quot;</span><span class="p">,</span>
        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;electro, punk&quot;</span><span class="p">,</span>
        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;2007-11-19&quot;</span><span class="p">,</span>
        <span class="s2">&quot;popularity&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">upload</span><span class="o">.</span><span class="n">documents</span><span class="p">(</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;ducksearch.duckdb&quot;</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="c1"># Unique document identifier</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="p">],</span> <span class="c1"># List of fields to use for search.</span>
    <span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">,</span>
    <span class="n">dtypes</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;DATE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;popularity&quot;</span><span class="p">:</span> <span class="s2">&quot;INT&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="search">Search<a class="headerlink" href="#search" title="Permanent link">&para;</a></h2>
<p><code>search.documents</code> returns a list of list of documents ordered by relevance. We can control the number of documents to return using the <code>top_k</code> parameter. The following example demonstrates how to search for documents with the queries "punk" and "california" while filtering the results to include only documents with a date after 1970 and a popularity score greater than 8. We will order the results by a weighted sum of the BM25 score and the popularity score provided in the document.</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">ducksearch</span> <span class="kn">import</span> <span class="n">search</span>

<span class="n">search</span><span class="o">.</span><span class="n">documents</span><span class="p">(</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;ducksearch.duckdb&quot;</span><span class="p">,</span>
    <span class="n">queries</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;punk&quot;</span><span class="p">,</span> <span class="s2">&quot;california&quot;</span><span class="p">],</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">filters</span><span class="o">=</span><span class="s2">&quot;YEAR(date) &gt;= 1970 AND popularity &gt; 8&quot;</span><span class="p">,</span>
    <span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;0.8 * score + 0.2 * popularity DESC&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span class="p">[</span>
    <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Alive&quot;</span><span class="p">,</span>
            <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;electro, punk&quot;</span><span class="p">,</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;2007-11-19 00:00:00&quot;</span><span class="p">),</span>
            <span class="s2">&quot;popularity&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="mf">0.17841622233390808</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Hotel California&quot;</span><span class="p">,</span>
            <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;rock, pop&quot;</span><span class="p">,</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;1977-02-22 00:00:00&quot;</span><span class="p">),</span>
            <span class="s2">&quot;popularity&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="mf">0.156318798661232</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">],</span>
<span class="p">]</span>
</code></pre></div>
<p>Filters are SQL expressions that are applied to the search results. We can use every filtering function DuckDB provides such as <a href="https://duckdb.org/docs/sql/functions/date">date functions</a>.</p>
<p>Both <code>filters</code> and <code>order_by</code> parameters are optional. If not provided, the results are ordered by BM25 relevance and no filters are applied.</p>
<h2 id="delete-and-update-index">Delete and update index<a class="headerlink" href="#delete-and-update-index" title="Permanent link">&para;</a></h2>
<p>We can delete documents and update the BM25 weights accordingly using the <code>delete.documents</code> function.</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">ducksearch</span> <span class="kn">import</span> <span class="n">delete</span>

<span class="n">delete</span><span class="o">.</span><span class="n">documents</span><span class="p">(</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;ducksearch.duckdb&quot;</span><span class="p">,</span>
    <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>
<p>To update the index, we should first delete the documents and then upload the updated documents.</p>
<h2 id="extra-features">Extra features<a class="headerlink" href="#extra-features" title="Permanent link">&para;</a></h2>
<h3 id="huggingface">HuggingFace<a class="headerlink" href="#huggingface" title="Permanent link">&para;</a></h3>
<p>The <code>upload.documents</code> function can also index HuggingFace datasets directly from the url. The following example demonstrates how to index the FineWeb dataset from HuggingFace. We will use the fields "text" and "url" for search. We will also specify the data types for the "date", "token_count", and "language_score" fields to be able to filter the results.</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">ducksearch</span> <span class="kn">import</span> <span class="n">upload</span>

<span class="n">upload</span><span class="o">.</span><span class="n">documents</span><span class="p">(</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;fineweb.duckdb&quot;</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">],</span>
    <span class="n">documents</span><span class="o">=</span><span class="s2">&quot;https://huggingface.co/datasets/HuggingFaceFW/fineweb/resolve/main/sample/10BT/000_00000.parquet&quot;</span><span class="p">,</span>
    <span class="n">dtypes</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;DATE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;token_count&quot;</span><span class="p">:</span> <span class="s2">&quot;INT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;language_score&quot;</span><span class="p">:</span> <span class="s2">&quot;FLOAT&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">limit</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="c1"># demonstrate with a small dataset</span>
<span class="p">)</span>
</code></pre></div>
<p>We can then search the FineWeb dataset with the <code>search.documents</code> function. We order the results by BM25 score and then date.</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">ducksearch</span> <span class="kn">import</span> <span class="n">search</span>

<span class="n">search</span><span class="o">.</span><span class="n">documents</span><span class="p">(</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;fineweb.duckdb&quot;</span><span class="p">,</span>
    <span class="n">queries</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;earth science&quot;</span><span class="p">],</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;score DESC, date DESC&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span class="p">[</span>
    <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;urn:uuid:1e6ae53b-e0d7-431b-8d46-290244e597e9&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Earth Science Tutors in Rowland...&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id_1&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;urn:uuid:1e6ae53b-e0d7-431b-8d46-290244e597e9&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dump&quot;</span><span class="p">:</span> <span class="s2">&quot;CC-MAIN-2017-34&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://rowland.universitytutor.com/rowland_earth-science-tutoring&quot;</span><span class="p">,</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;2017-08-19 00:00:00&quot;</span><span class="p">),</span>
            <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://commoncrawl/crawl-data/CC-MAIN-2017-34/segments/1502886105304.35/warc/CC-MAIN-20170819051034-20170819071034-00240.warc.gz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
            <span class="s2">&quot;language_score&quot;</span><span class="p">:</span> <span class="mf">0.8718525171279907</span><span class="p">,</span>
            <span class="s2">&quot;token_count&quot;</span><span class="p">:</span> <span class="mi">313</span><span class="p">,</span>
            <span class="s2">&quot;bm25id&quot;</span><span class="p">:</span> <span class="mi">523</span><span class="p">,</span>
            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="mf">2.3761106729507446</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;urn:uuid:cd94a04f-1632-4c8b-81d2-cb353163116e&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;- Geomagnetic field....&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id_1&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;urn:uuid:cd94a04f-1632-4c8b-81d2-cb353163116e&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dump&quot;</span><span class="p">:</span> <span class="s2">&quot;CC-MAIN-2022-21&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.imperial.ac.uk/people/adrian.muxworthy/?respub-action=citation.html&amp;id=1149861&amp;noscript=noscript&quot;</span><span class="p">,</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;2022-05-20 00:00:00&quot;</span><span class="p">),</span>
            <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://commoncrawl/crawl-data/CC-MAIN-2022-21/segments/1652662530553.34/warc/CC-MAIN-20220519235259-20220520025259-00601.warc.gz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;language&quot;</span><span class="p">:</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span>
            <span class="s2">&quot;language_score&quot;</span><span class="p">:</span> <span class="mf">0.8225595951080322</span><span class="p">,</span>
            <span class="s2">&quot;token_count&quot;</span><span class="p">:</span> <span class="mi">517</span><span class="p">,</span>
            <span class="s2">&quot;bm25id&quot;</span><span class="p">:</span> <span class="mi">4783</span><span class="p">,</span>
            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="mf">2.3569871187210083</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">]</span>
<span class="p">]</span>
</code></pre></div>
<p>Note: by default, results are ordered by BM25 relevance.</p>
<h2 id="tables">Tables<a class="headerlink" href="#tables" title="Permanent link">&para;</a></h2>
<p>Ducksearch creates two distinct schemas: <code>bm25_tables</code>, <code>bm25_documents</code>.</p>
<ul>
<li>
<p>We can find the uploaded documents in the <code>bm25_tables.documents</code> table.</p>
</li>
<li>
<p>We can find the inverted index in the <code>bm25_documents.scores</code> table. You can update the scores as you wish. Just note that tokens scores will be updated each time you upload documents (every tokens scores mentionned in the set of uploaded documents).</p>
</li>
<li>
<p>We can update the set of stopwords in the <code>bm25_documents.stopwords</code> table.</p>
</li>
</ul>
<h2 id="benchmark">Benchmark<a class="headerlink" href="#benchmark" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Dataset</th>
<th>ndcg@10</th>
<th>hits@1</th>
<th>hits@10</th>
<th>mrr@10</th>
<th>map@10</th>
<th>r-precision</th>
<th>qps</th>
<th>Indexation Time (s)</th>
<th>Number of Documents and Queries</th>
</tr>
</thead>
<tbody>
<tr>
<td>arguana</td>
<td>0.3779</td>
<td>0.0</td>
<td>0.8267</td>
<td>0.2491</td>
<td>0.2528</td>
<td>0.0108</td>
<td>117.80</td>
<td>1.42</td>
<td>1,406 queries, 8.67K documents</td>
</tr>
<tr>
<td>climate-fever</td>
<td>0.1184</td>
<td>0.1068</td>
<td>0.3648</td>
<td>0.1644</td>
<td>0.0803</td>
<td>0.0758</td>
<td>5.88</td>
<td>302.39</td>
<td>1,535 queries, 5.42M documents</td>
</tr>
<tr>
<td>dbpedia-entity</td>
<td>0.6046</td>
<td>0.7669</td>
<td>5.6241</td>
<td>0.8311</td>
<td>0.0649</td>
<td>0.0741</td>
<td>113.20</td>
<td>181.42</td>
<td>400 queries, 4.63M documents</td>
</tr>
<tr>
<td>fever</td>
<td>0.3861</td>
<td>0.2583</td>
<td>0.5826</td>
<td>0.3525</td>
<td>0.3329</td>
<td>0.2497</td>
<td>74.40</td>
<td>329.70</td>
<td>6,666 queries, 5.42M documents</td>
</tr>
<tr>
<td>fiqa</td>
<td>0.2445</td>
<td>0.2207</td>
<td>0.6790</td>
<td>0.3002</td>
<td>0.1848</td>
<td>0.1594</td>
<td>545.77</td>
<td>6.04</td>
<td>648 queries, 57K documents</td>
</tr>
<tr>
<td>hotpotqa</td>
<td>0.4487</td>
<td>0.5059</td>
<td>0.9699</td>
<td>0.5846</td>
<td>0.3642</td>
<td>0.3388</td>
<td>48.15</td>
<td>163.14</td>
<td>7,405 queries, 5.23M documents</td>
</tr>
<tr>
<td>msmarco</td>
<td>0.8951</td>
<td>1.0</td>
<td>8.6279</td>
<td>1.0</td>
<td>0.0459</td>
<td>0.0473</td>
<td>35.11</td>
<td>202.37</td>
<td>6,980 queries, 8.84M documents</td>
</tr>
<tr>
<td>nfcorpus</td>
<td>0.3301</td>
<td>0.4396</td>
<td>2.4087</td>
<td>0.5292</td>
<td>0.1233</td>
<td>0.1383</td>
<td>3464.66</td>
<td>0.99</td>
<td>323 queries, 3.6K documents</td>
</tr>
<tr>
<td>nq</td>
<td>0.2451</td>
<td>0.1272</td>
<td>0.4574</td>
<td>0.2099</td>
<td>0.1934</td>
<td>0.1240</td>
<td>150.23</td>
<td>71.43</td>
<td>3,452 queries, 2.68M documents</td>
</tr>
<tr>
<td>quora</td>
<td>0.7705</td>
<td>0.6783</td>
<td>1.1749</td>
<td>0.7606</td>
<td>0.7206</td>
<td>0.6502</td>
<td>741.13</td>
<td>3.78</td>
<td>10,000 queries, 523K documents</td>
</tr>
<tr>
<td>scidocs</td>
<td>0.1025</td>
<td>0.1790</td>
<td>0.8240</td>
<td>0.2754</td>
<td>0.0154</td>
<td>0.0275</td>
<td>879.11</td>
<td>4.46</td>
<td>1,000 queries, 25K documents</td>
</tr>
<tr>
<td>scifact</td>
<td>0.6908</td>
<td>0.5533</td>
<td>0.9133</td>
<td>0.6527</td>
<td>0.6416</td>
<td>0.5468</td>
<td>2153.64</td>
<td>1.22</td>
<td>300 queries, 5K documents</td>
</tr>
<tr>
<td>trec-covid</td>
<td>0.9533</td>
<td>1.0</td>
<td>9.4800</td>
<td>1.0</td>
<td>0.0074</td>
<td>0.0077</td>
<td>112.38</td>
<td>22.15</td>
<td>50 queries, 171K documents</td>
</tr>
<tr>
<td>webis-touche2020</td>
<td>0.4130</td>
<td>0.5510</td>
<td>3.7347</td>
<td>0.7114</td>
<td>0.0564</td>
<td>0.0827</td>
<td>104.65</td>
<td>44.14</td>
<td>49 queries, 382K documents</td>
</tr>
</tbody>
</table>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><a href="https://duckdb.org/">DuckDB</a></p>
</li>
<li>
<p><a href="https://duckdb.org/docs/extensions/full_text_search.html">DuckDB Full Text Search</a>: Note that DuckSearch rely partially on the DuckDB Full Text Search extension but accelerate the search process via <code>top_k_token</code> approximation, pre-computation of scores and multi-threading.</p>
</li>
</ul>
<h2 id="license">License<a class="headerlink" href="#license" title="Permanent link">&para;</a></h2>
<p>DuckSearch is released under the MIT license.</p>
<h2 id="citation">Citation<a class="headerlink" href="#citation" title="Permanent link">&para;</a></h2>
<div class="language-text highlight"><pre><span></span><code>@misc{PyLate,
  title={DuckSearch, efficient search with DuckDB},
  author={Sourty, Raphael},
  url={https://github.com/lightonai/ducksearch},
  year={2024}
}
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/lightonai/ducksearch" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["content.code.copy", "navigation.tabs", "navigation.instant", "navigation.indexes", "navigation.prune"], "search": "assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.471ce7a9.min.js"></script>
      
        <script src="javascripts/config.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3.2/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="javascripts/tablesort.js"></script>
      
    
  </body>
</html>